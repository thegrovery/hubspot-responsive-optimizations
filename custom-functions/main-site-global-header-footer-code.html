<!-- ===== =============== ===== -->
<!-- ===== START HEAD CODE ===== -->
<!-- ===== =============== ===== -->

    <!-- ONEai Agent -->
    <script id="oneai-snippet" src="https://oneai.com/~widget?id=the-grovery-ai-digital-assistant"></script>

    <!-- Google Tag Manager - Main Copy -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WBSCSF3');</script>
    <!-- End Google Tag Manager -->

    <!-- Google Tag Manager - Vendor Copy -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(
	j,f);})(window,document,'script','dataLayer','GTM-NMDCMNJ3');</script>
    <!-- End Google Tag Manager -->

<!-- ===== ============= ===== -->
<!-- ===== END HEAD CODE ===== -->
<!-- ===== ============= ===== -->


<!-- ===== ================= ===== -->
<!-- ===== START FOOTER CODE ===== -->
<!-- ===== ================= ===== -->

<script>
/********************************************

UTM LOGGER

NOTES:
	-	JS session closes when tab/browser is closed.
	-	JS localstorage can be used for semi premanent storage

code example:
	
	var searchParams = new URLSearchParams(window.location.search); //store as var
	searchParams.has('sent'); //true/false

UTM Parameter example:

	https://website.com?utm_source=test&utm_medium=test&utm_campaign=test&utm_term=test&utm_content=test

UTM parameters supported:
	utm_source
	utm_medium
	utm_campaign
	utm_term
	utm_content
	utm_state - EXPERIMENTAL
	
********************************************/
	console.log("===== UTM tracking initialized =====");

	/* =============================== */
	/* ===== Define DOM Variables  ===== */
	/* =============================== */
		
		
		/* ===== UTM Tester vars  ===== */
		/*var tester = document.querySelector(".UTMTesterTool");
		var testerUtmSource = document.querySelector(".UTMTesterTool [data-utm='utm_source']");
		var testerUtmMedium = document.querySelector(".UTMTesterTool [data-utm='utm_medium']");
		var testerUtmCampaign = document.querySelector(".UTMTesterTool [data-utm='utm_campaign']");
		var testerUtmTerm = document.querySelector(".UTMTesterTool [data-utm='utm_term']");
		var testerUtmContent = document.querySelector(".UTMTesterTool [data-utm='utm_content']");
		var testerUtmState = document.querySelector(".UTMTesterTool [data-utm='utm_state']");*/
	/* ============================= */
	/* ===== Primary Functions  ===== */
	/* ============================= */
		/***** Log UTM values *****/	
		function utm_logger(param) {
			var searchParams = new URLSearchParams(window.location.search); 
			var paramValue = "";
			var utm_state = "";

			if(searchParams.has(param)) {
				//if UTM parameters are present in URL
				//console.log("===== UTM values detected - in URL =====");
				utm_state = "url";
				paramValue = searchParams.get(param);
				sessionStorage.setItem(param, paramValue);
				localStorage.setItem(param, paramValue);

			}else if(sessionStorage.getItem(param)){
				//if UTM parameters are not present in URL, but are in SessionStorage
				//console.log("===== UTM values detected - in short-term session =====");
				utm_state = "sessionStorage";
				paramValue = sessionStorage.getItem(param);

			}else if(localStorage.getItem(param)){
				//if UTM parameters are not present in URL or SessionStorage, but are in LocalStorage
				//console.log("===== UTM values detected - in long-term session =====");
				utm_state = "localStorage";
				paramValue = localStorage.getItem(param);

			}
			console.log("UTM detected: "+param+": "+paramValue+", utm_state: "+utm_state);
			//return paramValue;
			return {paramValue, utm_state};

		};

		/***** Fill in UTM values in form *****/
		function utm_form_fill() {
            let inputUtmSource = document.querySelector('input[name="utm_source"]');
            let inputUtmMedium = document.querySelector('input[name="utm_medium"]');
            let inputUtmCampaign = document.querySelector('input[name="utm_campaign"]');
            let inputUtmTerm = document.querySelector('input[name="utm_term"]');
            let inputUtmContent = document.querySelector('input[name="utm_content"]');
            let inputUtmState = document.querySelector('input[name="utm_state"]');

			console.log("form fill run | update_1.1");
			inputUtmSource.value = utm_source.paramValue;
			inputUtmMedium.value = utm_medium.paramValue;
			inputUtmCampaign.value = utm_campaign.paramValue;
			inputUtmTerm.value = utm_term.paramValue;
			inputUtmContent.value = utm_content.paramValue;
			inputUtmState.value = utm_source.utm_state;
			console.log("UTM form inputs filled");
		};

		/***** Fill in testing tool *****/
		/*function utm_test_fill() {
			testerUtmSource.textContent = utm_source.paramValue;
	  		testerUtmMedium.textContent = utm_medium.paramValue;
	  		testerUtmCampaign.textContent = utm_campaign.paramValue;
	  		testerUtmTerm.textContent = utm_term.paramValue;
	  		testerUtmContent.textContent = utm_content.paramValue;
	  		testerUtmState.textContent = utm_state;
		};*/

	/* ======================== */
	/* ===== Run Functions ===== */
	/* ======================== */
		
		/***** Grab UTMs *****/
		var utm_source = utm_logger("utm_source");
		var utm_medium = utm_logger("utm_medium");
		var utm_campaign = utm_logger("utm_campaign");
		var utm_term = utm_logger("utm_term");
		var utm_content = utm_logger("utm_content");
		var utm_state = utm_source.utm_state;

		/***** Fill form after X seconds *****/
		setTimeout(() => {
			utm_form_fill();
		  	console.log("UTM form fill - delayed for 3000ms.");
			/*if(tester){
				utm_test_fill();
			}*/
		}, 3000);
		
</script>


<script>
	/*===== General Parameter Logger - use for dynamic content control =====*/
		function parameterLogger(param) {
			var searchParams = new URLSearchParams(window.location.search); 
			var paramValue = "";
			var paramState = "";

			if(searchParams.has(param)) {
				//if UTM parameters are present in URL
				//console.log("===== UTM values detected - in URL =====");
				paramState = "url";
				paramValue = searchParams.get(param);
				sessionStorage.setItem(param, paramValue);
				localStorage.setItem(param, paramValue);

			}else if(sessionStorage.getItem(param)){
				//if UTM parameters are not present in URL, but are in SessionStorage
				//console.log("===== UTM values detected - in short-term session =====");
				paramState = "sessionStorage";
				paramValue = sessionStorage.getItem(param);

			}else if(localStorage.getItem(param)){
				//if UTM parameters are not present in URL or SessionStorage, but are in LocalStorage
				//console.log("===== UTM values detected - in long-term session =====");
				paramState = "localStorage";
				paramValue = localStorage.getItem(param);

			}
			console.log("UTM detected: "+param+": "+paramValue+", paramState: "+paramState);
			//return paramValue;
			return {paramValue, paramState};

		};

		

	/*===== Run Functions =====*/
  		document.addEventListener("DOMContentLoaded", function(e){
            var browsingContext = parameterLogger("browsing-context");
		console.log(browsingContext);

		if(browsingContext.paramValue == 'default'){
			//reset, change nothing
		}else if(browsingContext.paramValue == 'healthcare'){
			//healthcare context
			console.log('Browsing Context: healthcare context');
      		console.log('To reset Browsing Context, add "?browsing-context=default" to url');
          setTimeout(() => {
            //needs delay to account for hubspot loading in elements
            var target = document.querySelector('.header__logo-link');
            var target2 = document.querySelector('#hs-link-widget_1703178251042_');
            //console.log("target element:"+target);
            //console.log("target2 element:"+target2);
			target.setAttribute("href", "https://thegrovery.com/health");
            target2.setAttribute("href", "https://thegrovery.com/health");
          }, 2000); //time in ms
			
		} else{
			//no extra context
		}
        });
		
</script>

<!-- ===== =============== ===== -->
<!-- ===== END FOOTER CODE ===== -->
<!-- ===== =============== ===== -->